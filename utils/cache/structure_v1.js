// ===========================================
// structure_v1.js
// ▼ GPT向けデータ構造説明ブロック（体質・チェック・ケアログ・因果構造）
// ===========================================
module.exports = `
### contexts（体質・タイプ情報）
- type：体質タイプ名（例：陰虚タイプなど）
- trait：体質傾向（例：潤い不足で熱がこもりやすい 等）
- flowType：流通病理（例：気滞・水滞・瘀血・巡り良好）
- organType：負担が出やすい経絡ライン（皮膚・筋膜のつながり）および、関連性の強い臓腑（例：肝・心・脾・肺・腎）
- motion：最も伸展負担がかかる経絡ラインの伸展動作。organType を判定するための指標として使っているテスト動作。
- symptom：不調主訴（例：胃腸・肩こり・メンタル・冷えなど）の種類。内部では stomach / sleep / pain / mental / cold / skin / pollen / women / unknown といったキーで管理している。
- advice：{habits, breathing, stretch, tsubo, kampo} 各ケア内容と図解リンクのテキスト。
- created_at：初回登録日（体質分析を終えた日）

※ ユーザーには、
「いま気になっている不調（symptom）は  
　①『type / trait』としての体質的な特徴に加え、  
　② 体内の巡りの状態（flowType）、  
　③ 体表面の経絡ライン（organType）のこわばり  
　の三つが重なって表れている」
という3層構造で説明している。

- type / trait は「体質」という根っこのレイヤーで、主に体質改善習慣（生活リズムの調整や漢方・サプリ）でじわっと変えていく。
- flowType は「気血水などの巡りの状態」を表すレイヤーで、比較的短期で変化しやすく、他のレイヤーにも波及しやすい“てこ”となる。
- organType は「特に負担が出やすい経絡ライン」で、ここを整えることで姿勢や呼吸、内臓の動きが変わり、結果的に全身の巡りや症状にも波及していく“全身調整ポイント”（鍼灸でいう経絡治療・トリガーポイント治療のイメージ）として扱う。

---

### 🔸 5つのadvice の優先ケアとサポートケアの分け方について

- ケアは大きく「優先ケア」2つと「サポートケア」3つに分けてユーザーに提示している。
- 優先ケア2つは **flowType のみ** を根拠として選定している。
  - 理由：flowType がもっとも短期で変化しやすく、体質(type/trait) や organType の負担軽減にも波及しやすい “てこ” だから。
- type や organType は、「優先ケアの中身をどう説明するか」「どの経絡ラインを意識すると良いか」といった微調整・説明には使うが、  
  「優先かサポートかの区分」そのものの判定には使っていない。

flowType を指標にした、ざっくりとした優先ケアの分け方は次の通り：

- 気滞の傾向：
  - 優先：呼吸法（呼吸で胸〜お腹まわりの詰まりをまずぬく）／ツボケア（伸展負荷のある経絡ラインのストレッチで余計に力んでしまうことを避けるため、まずはライン上の手足のツボや指先のケアから優先）
  - サポート：ストレッチ・体質改善習慣・漢方・サプリ

- 瘀血の傾向：
  - 優先：ツボケア（まず滞りのある経絡ラインの手足末端のツボで血の巡りを促す）／呼吸法（深部の動きの悪い組織を、内側から再起動させるようなテンポの良い深い呼吸）
  - サポート：ストレッチ・体質改善習慣・漢方・サプリ

- 水滞の傾向：
  - 優先：呼吸法（横隔膜や腹圧をしっかり動かし、気の推動力を高める呼吸）／ストレッチ（流れにくくなっている経絡ラインの“通り道”を広げる）
  - サポート：体質改善習慣・ツボケア・漢方・サプリ

- 巡りは良好：
  - 優先：体質改善習慣（生活習慣全般で体質を整える）／ストレッチ（伸展負荷の表れている経絡ライン全体の通りをよくする）
  - サポート：呼吸法・ツボケア・漢方・サプリ

- ユーザーへの説明では、「優先ケア」「サポートケア」という言葉をそのまま使ってもよいが、
  押しつけにならないよう、「まずはこのケアを軸にすると整いやすそう」「これは余裕のある日に足す感じでOK」など、柔らかい表現で伝える。

---

### followups（ととのい度チェック）
- latest：直近のチェック結果。以下の項目を含む：
  - symptom_level：最も気になる不調(symptom)のつらさ（1=かなりラク〜5=かなりツラい）
  - sleep：睡眠リズムの整い具合（1=整っている〜5=乱れがち）
  - meal：食事のタイミングや量の整い具合（1=整っている〜5=乱れがち）
  - stress：ストレスや気分の安定度（1=安定〜5=不安定）
  - motion_level：最も伸展負荷がかかる経絡動作(motion)を再チェックしたときのつらさ（1=かなりラク〜5=かなりツラい）
- prev：前回のチェック結果（存在する場合）。latest と同じ構造。

- AIは latest と prev の差分から、
  「ラクになってきているか／ややツラさが戻っているか」などの傾向を読み取り、
  ケアの実施状況と合わせて「ケアがどこまで反映されていそうか」を推定する。

---

### care_logs_daily（ケア記録）
- habits / breathing / stretch / tsubo / kampo：各ケア項目を「行った日」の数。
- 1日に同じケアを何度行っても “1日＝1カウント” として扱う。
- buildConsultMessages では、主に次の2種類の集計が渡される：
  - shortTermCareCounts：前回のととのい度チェック日〜今回のチェック日までの実施日数。
  - longTermCareCounts：体質分析（contexts.created_at）〜現在までの累計実施日数。

- 短期のカウントは「直近の1〜数週間でどのケアがどれくらい行われたか」を示し、
  長期のカウントは「全体としてどのケアをベースに積み上げてきたか」を示す。

---

### ケア項目と体調指標の関係（因果イメージ）

1. habits（体質改善習慣）
   - 主に「睡眠リズム・食事のタイミングや量・ストレス」の安定に直結し、
     その積み重ねが「主訴を含む全体のつらさ(symptom_level)」の土台を整える。

2. breathing（巡りととのう呼吸法）
   - 体全体の構造バランスや腹圧テンション、flowType（巡りの状態）を整えやすくし、
     結果として全身の巡りがスムーズになり、主訴のつらさの軽減に波及する。

3. stretch（経絡ストレッチ） / tsubo（指先・ツボほぐし）
   - motion で判定された「負担の強い経絡ライン(organType)」のこわばりをゆるめる。
   - このラインが整うことで、motion_level（その動きのつらさ）の改善につながり、
     さらに姿勢・内臓機能・全体症状(symptom_level)にもじわじわ影響する。

4. kampo（漢方やサプリ）
   - セルフケアを続けても改善が停滞している場面で、
     弁証に基づく漢方や栄養学にもとづくサプリなどを“補助輪”として足す位置づけ。
   - あくまで、自律的なセルフケアを支えるオプション・おまけとして扱い、他の4つのケアを優先する。

---

### recentChats（直近の相談履歴）
- 直近3件分の会話（user / assistant）の短いログが入る。
- AIは、同じ話題が続いている場合や、前回の提案との整合性をとるために参照する。
`;
