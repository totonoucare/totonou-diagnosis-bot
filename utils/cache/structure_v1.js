// utils/cache/structure_v1.js
// ▼ GPT向けデータ構造説明ブロック（体質・チェック・ケアログ・優先ケア・因果構造）
module.exports = `
### contexts（体質・タイプ情報：データ構造）
- type：
  体質タイプ名（例：陰虚タイプ・気虚タイプなど）。

- trait：
  その体質タイプの特徴説明テキスト。

- flowType：
  体内の巡りの傾向（例：気滞・水滞・瘀血・巡り良好）。

- organType：
  負担が出やすい経絡ライン（皮膚・筋膜のつながり）および、
  関連性の強い臓腑（例：肝・心・脾・肺・腎）。

- motion：
  最も伸展負担がかかる経絡ラインの伸展動作。
  organType を判定するためのテスト動作として使っている。

- symptom：
  不調主訴（例：胃腸・肩こり・メンタル・冷えなど）の種類。
  内部では stomach / sleep / pain / mental / cold / skin / pollen / women / unknown
  といったキーで管理している。

- advice：
  {habits, breathing, stretch, tsubo, kampo} の形で、
  各ケア内容と図解リンクのテキストが入る。
  （ユーザー向けにはカルーセルカードとして表示される）

- created_at：
  初回登録日（体質分析を終えた日）。

※ 概念的には、
- type / trait は「体質」という根っこのレイヤー。
- flowType は「気血水などの巡りの状態」を表すレイヤー。
- organType は「特に負担が出やすい経絡ライン」で、
  ここを整えることで姿勢や呼吸、内臓の動きが変わり、
  結果的に全身の巡りや症状にも波及していく“全身調整ポイント”
  （経絡治療・トリガーポイント治療のイメージ）として扱っている。

---

### followups（ととのい度チェック：データ構造とスコアの読み方）
- latest：
  直近のチェック結果。以下の項目を含む：

  - symptom_level：
    最も気になる不調(symptom)のつらさ。
    1 = かなりラク〜だいぶラク  
    2 = だいぶラク  
    3 = まあまあ普通  
    4 = ややツラい  
    5 = かなりツラい

  - sleep：
    睡眠リズムの整い具合。
    1〜2 = よく整っている  
    3     = 波がある／どちらともいえない  
    4〜5 = 乱れやすく負担が出やすい

  - meal：
    食事のタイミングや量の整い具合。
    1〜2 = だいたい整っている  
    3     = 乱れがち・ムラがある  
    4〜5 = タイミング/量の乱れが目立つ

  - stress：
    ストレスや気分の安定度。
    1〜2 = 比較的安定している  
    3     = 波が大きい／上下がある  
    4〜5 = 不安定・負担が強い

  - motion_level：
    最も伸展負荷がかかる経絡動作(motion)を再チェックしたときのつらさ。
    1〜2 = かなりラク〜だいぶラク  
    3     = 可もなく不可もなく  
    4〜5 = その動きがツラい・こわばりが強い

- prev：
  1つ前のチェック結果（存在する場合）。latest と同じ構造。

- AIは latest と prev の差分から、
  「ラクになってきているか／ややツラさが戻っているか」などの傾向を読み取り、
  ケアの実施状況と合わせて「ケアがどこまで反映されていそうか」を推定する。

---

### care_logs_daily（ケア記録：データ構造）
- habits / breathing / stretch / tsubo / kampo：
  各ケア項目を「行った日」の数。
  - 同じ日に同じケアを何度行っても、その日は 1 カウント。
  - 値が大きいほど「そのケアを行えた日」が多い。

- buildConsultMessages では、主に次の2種類の集計が渡される：
  - shortTermCareCounts：
    直近の followup（latest）作成日〜今回のチェック日までの実施日数。
    （「この1〜数週間でのケアの密度」を見るため）
  - longTermCareCounts：
    体質分析（contexts.created_at）〜現在までの累計実施日数。
    （「サービス全体を通してどのケアを土台にしてきたか」を見るため）

---

### 🔸 5つのケア（advice）の優先ケアとサポートケア

- ケアは大きく「優先ケア」2つと「サポートケア」3つに分けてユーザーに提示している。
- 優先ケア2つは **flowType のみ** を根拠として選定している。
  - 理由：flowType がもっとも短期で変化しやすく、
    体質(type/trait) や organType の負担軽減にも波及しやすい “てこ” だから。

- type や organType は、
  「優先ケアの中身をどう説明するか」
  「どの経絡ラインを意識すると良いか」といった微調整・説明には使うが、  
  「優先かサポートかの区分」そのものの判定には使っていない。

flowType を指標にした、ざっくりとした優先ケアの分け方は次の通り：

- 気滞の傾向：
  - 優先：呼吸法／ツボケア  
    （胸〜お腹まわりの詰まりを呼吸でぬきつつ、
      ライン上の手足のツボや指先から圧抜きする）
  - サポート：ストレッチ・体質改善習慣・漢方・サプリ

- 瘀血の傾向：
  - 優先：ツボケア／呼吸法  
    （滞りやすいラインの末端ツボで巡りを促しつつ、
      深い呼吸で動きの悪い組織を内側から再起動）
  - サポート：ストレッチ・体質改善習慣・漢方・サプリ

- 水滞の傾向：
  - 優先：呼吸法／ストレッチ  
    （横隔膜や腹圧をしっかり動かして推動力を高めつつ、
      流れにくいラインの“通り道”をストレッチで広げる）
  - サポート：体質改善習慣・ツボケア・漢方・サプリ

- 巡りは良好：
  - 優先：体質改善習慣／ストレッチ  
    （生活リズム全般で体質を整えつつ、
      負担の出やすいライン全体の通りを維持する）
  - サポート：呼吸法・ツボケア・漢方・サプリ

---

### ケア項目と体調指標の関係（因果イメージ）

1. habits（体質改善習慣）
   - 主に「睡眠リズム・食事のタイミングや量・ストレス」の安定に直結し、
     その積み重ねが「主訴を含む全体のつらさ（symptom_level）」の土台を整える。

2. breathing（巡りととのう呼吸法）
   - 体全体の構造バランスや腹圧テンション、flowType（巡りの状態）を整えやすくし、
     結果として全身の巡りがスムーズになり、主訴のつらさの軽減に波及する。

3. stretch（経絡ストレッチ） / tsubo（指先・ツボほぐし）
   - motion で判定された「負担の強い経絡ライン(organType)」のこわばりをゆるめる。
   - このラインが整うことで、motion_level（その動きのつらさ）の改善につながり、
     さらに姿勢・内臓機能・全体症状(symptom_level)にもじわじわ影響する。

4. kampo（漢方やサプリ）
   - セルフケアを続けても改善が停滞している場面で、
     弁証に基づく漢方や栄養学にもとづくサプリなどを“補助輪”として足す位置づけ。
   - あくまで、自律的なセルフケアを支えるオプション・おまけとして扱い、
     他の4つのケアを優先する。

---

### recentChats（直近の相談履歴）
- 直近3件分の会話（user / assistant）の短いログが入る。
- AIは、同じ話題が続いている場合や、
  前回の提案との整合性をとるために参照する。
`;
